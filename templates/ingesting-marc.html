{% extends 'base.html' %}

{% set category='activity' %}

{% block main %}
<h2>{{ title }}</h2>
<h1>Ingesting MARC</h1>
<p class="lead">
    For this activity we will use Python command-line to import the default 
    <a href="https://github.com/KnowledgeLinks/rdfw-bibcat/blob/master/ingesters/marc.py#L90">MARCIngester</a> 
    class from the <code>bibcat/ingesters/marc.py</code> module.
</p>
<h2>Ingesting a Single MARC21 Record</h2>
{% set py_prompt = 3*'&gt;' %}
<ol class="lead">
    <li>
        From your project directory, launch Python from the command-line: 
        <p>
            <kbd>(py3-env)&gt;python</kbd><br>
            <kbd>{{ py_prompt|safe }}{{ 13*'&nbsp;'|safe }}</kbd>
        </p>
        or launch Python IDLE:
        <p>
            <kbd>(py3-env)&gt;python -m idlelib</kbd>
        </p>
    </li>
    <li>
        Import the <code>pymarc</code> module 
        <p>
            <kbd>{{ py_prompt|safe }} import pymarc</kbd><br>
        </p>
    </li>
    <li>
        Create an instance <code>MARCReader</code> class using your own MARC21 file 
        or download the 150 MARC Record sample from Colorado College
        <a href="{{ url_for('static', filename='mrc/cc-marc-sample.mrc') }}">here</a>.</p>
        <pre class="bg-inverse rounded" style="color: white"><code>
{{ py_prompt|safe }} reader = pymarc.MARCReader(
        open("/tmp/rdf-app/cc-marc-sample.mrc", "rb"), 
        to_unicode=True)
        </code></pre>
    </li>
    <li>
        Retrieve the first MARC21 record from the reader 
        <br>
        <kbd>{{ py_prompt|safe }} first_record = next(reader)</kbd><br>
        and print the record
        <pre  class="bg-inverse rounded" style="color: white"><code>{{ py_prompt|safe }} print(first_record)
=LDR  00947cam a2200313 a 4500
=001  40163506
=003  OCoLC
=005  19990428161357.0
=008  981009s1999\\\\mau\\\\\\b\\\\001\0\eng\\
=010  \\$a98047634
=020  \\$a0395691303
=040  \\$aDLC$cDLC$dC#P
=049  \\$aCOCA
=050  00$aQP38$b.A54 1999
=090  \\$aQP38$b.A54 1999
=100  1\$aAngier, Natalie.
=245  10$aWoman :$ban intimate geography /$cNatalie Angier.
=260  \\$aBoston :$bHoughton Mifflin,$c1999.
=300  \\$axvi, 398 p. ;$c24 cm.
=500  \\$a"A Peter Davison book."
=504  \\$aIncludes bibliographical references (p. 369-382) and index.
=650  \0$aWomen$xPhysiology.
=650  \0$aWomen$xPsychology.
=650  \0$aSex differences.
=902  \\$a150104
=907  \\$a.b13627557
=945  \\$aQP38$b.A54 1999$g1$i33027003963844$j0$ltbp  $h0$oc$p$0.00$q $r-$s-$t1$u7$v0$w0$x0$y.i14279873$z990428
=994  \\$atbp
=999  \\$b1$c990428$dm$ea$fc$g0
        </code></pre>

    </li>
    <li>
        Import the <code>MARCIngester</code> Class with the RDF Framework's
        BIBCAT MARC Ingestion Rules in Turtle RDF format located at 
        <a href="https://github.com/KnowledgeLinks/rdfw-bibcat/blob/master/rdfw-definitions/kds-bibcat-marc-ingestion.ttl">kds-bibcat-marc-ingestion.ttl</a>.<br>
        <kbd>{{ py_prompt|safe }} from bibcat.ingesters.marc import MARCIngester</kbd>
    </li>
    <li>
        Create an instance of the <code>MARCIngester</code> Class 
        using the default RDF Rules<br>
        <kbd>{{ py_prompt|safe }} marc_ingester = MARCIngester()</kbd> 
    </li>
    <li>
        Display the number of triples in the RDF Rules Graph loaded from 
        <code>kds-bibcat-marc-ingestion.ttl</code><br>
        <kbd>{{ py_prompt|safe }} len(marc_ingester.rules_graph)</kbd><br>
        <kbd>206</kbd> <br>
        Confirm that the BIBFRAME RDF Graph is empty.<br>
        <kbd>len(marc_ingester.graph)</kbd><br>
        <kbd>0</kbd>
    </li>
    
    <li>Run the <code>marc_ingester.transform</code> method on the <code>first_record</code><br>
    <kbd>marc_ingester.transform(record=first_record)</kbd> 
    </li>
    <li>Print the BIBFRAME graph serialized as RDF Turtle<br>
    <pre  class="bg-inverse rounded" style="color: white"><code>{{ py_prompt|safe }} print(marc_ingester.graph.serialize(format='turtle'))
@prefix bc: &lt;http://knowledgelinks.io/ns/bibcat/&gt; .
@prefix bf: &lt;http://id.loc.gov/ontologies/bibframe/&gt; .
@prefix dbo: &lt;http://dbpedia.org/ontology/&gt; .
@prefix dbp: &lt;http://dbpedia.org/property/&gt; .
@prefix dbr: &lt;http://dbpedia.org/resource/&gt; .
@prefix dc: &lt;http://purl.org/dc/elements/1.1/&gt; .
@prefix dcterm: &lt;http://purl.org/dc/terms/&gt; .
@prefix dpla: &lt;http://dp.la/about/map/&gt; .
@prefix edm: &lt;http://www.europeana.eu/schemas/edm/&gt; .
@prefix es: &lt;http://knowledgelinks.io/ns/elasticsearch/&gt; .
@prefix kdr: &lt;http://knowledgelinks.io/ns/data-resources/&gt; .
@prefix kds: &lt;http://knowledgelinks.io/ns/data-structures/&gt; .
@prefix loc: &lt;http://id.loc.gov/authorities/&gt; .
@prefix m21: &lt;http://knowledgelinks.io/ns/marc21/&gt; .
@prefix mods: &lt;http://www.loc.gov/mods/v3&gt; .
@prefix ore: &lt;http://www.openarchives.org/ore/terms/&gt; .
@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix relators: &lt;http://id.loc.gov/vocabulary/relators/&gt; .
@prefix schema: &lt;http://schema.org/&gt; .
@prefix skos: &lt;http://www.w3.org/2004/02/skos/core#&gt; .
@prefix void: &lt;http://rdfs.org/ns/void#&gt; .
@prefix xml: &lt;http://www.w3.org/XML/1998/namespace&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

&lt;http://bibcat.org/9e054b36-0097-11e7-b2b0-a8667f19014b&gt; a bf:Item ;
    bf:generationProcess [ a bf:GenerationProcess ;
            bf:generationDate "2017-03-04T05:01:24.971684" ;
            rdf:value "Generated by BIBCAT version 1.7.5 from KnowledgeLinks.io"@en ] ;
    bf:itemOf &lt;http://dpla.coloradovirtuallibrary.org/9d817a06-0097-11e7-897a-a8667f19014b&gt; .

&lt;http://bibcat.org/9d817a06-0097-11e7-897a-a8667f19014b&gt; a bf:Instance ;
    bf:classification [ a bf:ClassificationLcc ;
            rdf:value "QP38 .A54 1999" ] ;
    bf:copyrightDate "1999." ;
    bf:dimensions "24 cm." ;
    bf:extent [ a bf:Extent ;
            rdf:value "xvi, 398 p. ;" ] ;
    bf:generationProcess [ a bf:GenerationProcess ;
            bf:generationDate "2017-03-04T05:01:24.917334" ;
            rdf:value "Generated by BIBCAT version 1.7.5 from KnowledgeLinks.io"@en ] ;
    bf:identifiedBy [ a bf:Isbn ;
            rdf:value "0395691303" ] ;
    bf:instanceOf [ a bf:Work ;
            bf:originDate "1999" ] ;
    bf:provisionActivity [ a bf:Publication ;
            relators:pbl "Houghton Mifflin," ] ;
    bf:subject [ a bf:Topic ;
            rdf:value "Women" ],
        [ a bf:Topic ;
            rdf:value "Sex differences." ],
        [ a bf:Topic ;
            rdf:value "Women" ] ;
    bf:supplementaryContent [ a bf:SupplementaryContent ;
            rdf:value "Includes bibliographical references (p. 369-382) and index." ] ;
    bf:title [ a bf:InstanceTitle ;
            bf:mainTitle "Woman :" ;
            bf:subtitle "an intimate geography /" ] ;
    relators:aut [ a bf:Person ;
            schema:name "Angier, Natalie." ] .

</code></pre>
</ol>
<h2>Creating Custom Turtle RDF Rules File</h2>
<ol class="lead">
    <li>Start with a new terminal window and create a new 
        <strong>custom</strong> directory<br>
        <kbd>mkdir custom</kbd>

    </li>
    <li>Open a text editor and copy these RDF Namespaces into a new
    file:<br>
    <pre class="rounded bg-faded"><code>
@prefix bc: &lt;http://knowledgelinks.io/ns/bibcat/&gt; .
@prefix bf: &lt;http://id.loc.gov/ontologies/bibframe/&gt; .
@prefix kds: &lt;http://knowledgelinks.io/ns/data-structures/&gt; .
@prefix kdr: &lt;http://knowledgelinks.io/ns/data-resources/&gt; .
@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .
@prefix relators: &lt;http://id.loc.gov/vocabulary/relators/&gt; .
@prefix m21: &lt;http://knowledgelinks.io/ns/marc21/&gt; .
@prefix schema: &lt;http://schema.org/&gt; .
@prefix loc: &lt;http://id.loc.gov/authorities/&gt; .
    </code></pre>
    </li>
    <li>The first rule will be to associate a new BIBFRAME Item with Colorado 
    College's Tutt Library using the IRI of 
    <a href="https://www.coloradocollege.edu/library/">https://www.coloradocollege.edu/library/</a> through the <code>bf:heldBy</code> 
    predicate (substitute your own institutional IRI defined in 
    the <a href="{{ url_for('slide', page='create-knowledge-graph') }}">Knowledge Graph</a> activity) <br><br>
    <pre class="rounded bg-faded"><code>
bc:bf-Organization a kds:PropertyLinker;
    kds:destPropUri [ bf:heldBy &lt;https://www.coloradocollege.edu/library/&gt; ] ;
    kds:destClassUri bf:Item .
    </code></pre>
    </li>
    {#<li>
     
    </li>#}
    </ol>
<h2>Used in &hellip;</h2>
<div class="jumbotron">
<div class="row">
    <div class="col-md-4 offset-md-1">
        {% include 'cards/bibcat-coalliance.html' %}
    </div>
    <div class="col-md-6">
        <ul class="lead">
            <li>Generated Sample Set from Colorado Alliance Gold Rush&reg;
            Library Content Comparison System</li>    
            <li>MARC21 file separated into 10,000 record shards and then each
                shard was run with a separate instance of the MARC Ingester</li>
            <li>
                Result of transforming MARC into BIBFRAME Entities were saved as
                RDF Turtle files. Examples:
                <ul>
                    <li>
                        University of Colorado Boulder 40,000-to-50,000 MARC Record shard to BIBFRAME 
                        Turtle file:
                        <a href="https://github.com/KnowledgeLinks/alliance-bibcat/blob/master/data/cu-2016-40k-50k.ttl">
                        https://github.com/KnowledgeLinks/alliance-bibcat/blob/master/data/cu-2016-40k-50k.ttl</a>
                    </li>
                    <li> 
                        Colorado College MARC 10,000-to-20,000 MARC Records to BIBFRAME RDF Turtle file:
                        <a href="https://github.com/KnowledgeLinks/alliance-bibcat/blob/master/data/cc-2016-10k-20k.ttl">
                        https://github.com/KnowledgeLinks/alliance-bibcat/blob/master/data/cc-2016-10k-20k.ttl</a>
                    </li>

                </ul>
            </li>
        </ul>
    </div>
</div>
</div>
{% endblock %}
